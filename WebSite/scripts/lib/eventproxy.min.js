!function(g,k){var n="undefined"!==typeof module&&module.exports;"function"===typeof define?define(k):n?module.exports=k(require("debug")("eventproxy")):this[g]=k()}("EventProxy",function(g){g=g||function(){};var k=Array.prototype.slice,n=Array.prototype.concat,a=function(){if(!(this instanceof a))return new a;this._callbacks={};this._fired={}};a.prototype.addListener=function(b,e){g("Add listener for %s",b);this._callbacks[b]=this._callbacks[b]||[];this._callbacks[b].push(e);return this};a.prototype.bind=
a.prototype.addListener;a.prototype.on=a.prototype.addListener;a.prototype.subscribe=a.prototype.addListener;a.prototype.headbind=function(b,e){g("Add listener for %s",b);this._callbacks[b]=this._callbacks[b]||[];this._callbacks[b].unshift(e);return this};a.prototype.removeListener=function(b,e){var c=this._callbacks;if(b)if(e){if(c=c[b])for(var a=c.length,d=0;d<a;d++)e===c[d]&&(g("Remove a listener of %s",b),c[d]=null)}else g("Remove all listeners of %s",b),c[b]=[];else g("Remove all listeners"),
this._callbacks={};return this};a.prototype.unbind=a.prototype.removeListener;a.prototype.removeAllListeners=function(b){return this.unbind(b)};a.prototype.bindForAll=function(b){this.bind("__all__",b)};a.prototype.unbindForAll=function(b){this.unbind("__all__",b)};a.prototype.trigger=function(b,e){var c,a,d,h,m,p=2,l=this._callbacks;for(g("Emit event %s with data %j",b,e);p--;)if(c=p?b:"__all__",c=l[c])for(h=0,m=c.length;h<m;h++)(a=c[h])?(d=p?k.call(arguments,1):arguments,a.apply(this,d)):(c.splice(h,
1),h--,m--);return this};a.prototype.emit=a.prototype.trigger;a.prototype.fire=a.prototype.trigger;a.prototype.once=function(b,a){var c=this,f=function(){a.apply(c,arguments);c.unbind(b,f)};this.bind(b,f);return this};var q="undefined"!==typeof process&&process.nextTick||function(b){setTimeout(b,0)};a.prototype.emitLater=function(){var b=this,a=arguments;q(function(){b.trigger.apply(b,a)})};a.prototype.immediate=function(b,a,c){this.bind(b,a);this.trigger(b,c);return this};a.prototype.asap=a.prototype.immediate;
var u=function(b,a,c,f){var d=this,h=arguments.length,m=0,p={};if(3>h)return this;var l=k.call(arguments,0,-2),n=arguments[h-2],r=arguments[h-1];if("function"!==typeof n)return this;g("Assign listener for events %j, once is %s",l,!!r);for(var h=function(b){d[r?"once":"bind"](b,function(a){d._fired[b]=d._fired[b]||{};d._fired[b].data=a;p[b]||(p[b]=!0,m++)})},s=l.length,t=0;t<s;t++)h(l[t]);var q=function(b){if(!(m<s)&&p[b]){b=[];for(var a=0;a<s;a++)b.push(d._fired[l[a]].data);r&&d.unbindForAll(q);g("Events %j all emited with data %j",
l,b);n.apply(null,b)}};d.bindForAll(q)};a.prototype.all=function(b,a,c){var f=n.apply([],arguments);f.push(!0);u.apply(this,f);return this};a.prototype.assign=a.prototype.all;a.prototype.fail=function(b){var a=this;a.once("error",function(c){a.unbind();b.apply(null,arguments)});return this};a.prototype.tail=function(){var b=n.apply([],arguments);b.push(!1);u.apply(this,b);return this};a.prototype.assignAll=a.prototype.tail;a.prototype.assignAlways=a.prototype.tail;a.prototype.after=function(b,a,c){if(0===
a)return c.call(null,[]),this;var f=this,d=[];this._after=this._after||{};var h=b+"_group";this._after[h]={index:0,results:[]};g("After emit %s times, event %s's listenner will execute",a,b);var m=function(k,l){k===b&&(a--,d.push(l),1>a&&(g("Event %s was emit %s, and execute the listenner",b,a),f.unbindForAll(m),c.apply(null,[d])));k===h&&(a--,f._after[h].results[l.index]=l.result,1>a&&(g("Event %s was emit %s, and execute the listenner",b,a),f.unbindForAll(m),c.call(null,f._after[h].results)))};
f.bindForAll(m);return this};a.prototype.group=function(b,a){var c=this,f=b+"_group",d=c._after[f].index;c._after[f].index++;return function(b,g){if(b)return c.emit.apply(c,["error"].concat(k.call(arguments)));c.emit(f,{index:d,result:a?a.apply(null,k.call(arguments,1)):g})}};a.prototype.any=function(){var b=this,a=arguments[arguments.length-1],c=k.call(arguments,0,-1),f=c.join("_");g("Add listenner for Any of events %j emit",c);b.once(f,a);for(var a=function(a){b.bind(a,function(c){g("One of events %j emited, execute the listenner");
b.trigger(f,{data:c,eventName:a})})},d=0;d<c.length;d++)a(c[d])};a.prototype.not=function(a,e){g("Add listenner for not event %s",a);this.bindForAll(function(c,f){c!==a&&(g("listenner execute of event %s emit, but not event %s.",c,a),e(f))})};a.prototype.done=function(a,e){var c=this;return function(f,d){if(f)return c.emit.apply(c,["error"].concat(k.call(arguments)));var h=k.call(arguments,1);if("string"===typeof a)return e?c.emit(a,e.apply(null,h)):c.emit.apply(c,[a].concat(h));if(2>=arguments.length)return a(d);
a.apply(null,h)}};a.prototype.doneLater=function(a,e){var c=this.done(a,e);return function(a,b){var e=arguments;q(function(){c.apply(null,e)})}};a.create=function(){var b=new a,e=n.apply([],arguments);if(e.length){var c=e[e.length-1],f=e[e.length-2];"function"===typeof c&&"function"===typeof f&&(e.pop(),b.fail(c));b.assign.apply(b,e)}return b};return a.EventProxy=a});
